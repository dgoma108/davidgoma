// =========================================
// FORMS MODERNOS - DAVID GOMA
// =========================================

// MEJORAS BASE PARA FORMS DE BOOTSTRAP
// ====================================
.form-control {
  border: 2px solid $gray-200;
  border-radius: $border-radius-lg;
  padding: 0.75rem 1rem;
  font-size: $font-size-base;
  font-family: $font-family-sans-serif;
  transition: $transition-all;
  background: white;

  &:focus {
    border-color: $primary;
    box-shadow: 0 0 0 3px rgba($primary, 0.1);
    outline: none;
  }

  &::placeholder {
    color: $gray-400;
    font-weight: $font-weight-normal;
  }

  &:disabled,
  &[readonly] {
    background: $gray-50;
    border-color: $gray-200;
    color: $gray-500;
    cursor: not-allowed;
  }

  &.is-invalid {
    border-color: $danger;

    &:focus {
      border-color: $danger;
      box-shadow: 0 0 0 3px rgba($danger, 0.1);
    }
  }

  &.is-valid {
    border-color: $success;

    &:focus {
      border-color: $success;
      box-shadow: 0 0 0 3px rgba($success, 0.1);
    }
  }
}

// LABELS MODERNOS
// ===============
.form-label {
  font-weight: $font-weight-semibold;
  color: $gray-900;
  margin-bottom: 0.5rem;
  font-size: $font-size-sm;

  &.required {
    &::after {
      content: ' *';
      color: $danger;
    }
  }
}

// FLOATING LABELS MEJORADOS
// =========================
.form-floating {
  position: relative;

  .form-control {
    padding: 1.625rem 1rem 0.625rem;

    &:focus ~ .form-label,
    &:not(:placeholder-shown) ~ .form-label {
      color: $primary;
      transform: scale(0.85) translateY(-0.5rem) translateX(0.15rem);
    }
  }

  .form-label {
    position: absolute;
    top: 0;
    left: 0;
    padding: 1rem;
    pointer-events: none;
    border-radius: $border-radius-lg;
    transition: $transition-all;
    transform-origin: 0 0;
    color: $gray-500;
  }
}

// INPUT GROUPS MODERNOS
// ====================
.input-group {
  .input-group-text {
    background: $gray-50;
    border: 2px solid $gray-200;
    border-radius: $border-radius-lg;
    color: $gray-600;
    font-weight: $font-weight-medium;

    &.input-group-icon {
      @include center-flex();
      width: 3rem;

      .icon {
        width: 1.25rem;
        height: 1.25rem;
      }
    }
  }

  .form-control {
    &:not(:first-child) {
      border-left: none;
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
    }

    &:not(:last-child) {
      border-right: none;
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
    }

    &:focus {
      z-index: 3;
    }
  }

  > :first-child {
    border-top-left-radius: $border-radius-lg !important;
    border-bottom-left-radius: $border-radius-lg !important;
  }

  > :last-child {
    border-top-right-radius: $border-radius-lg !important;
    border-bottom-right-radius: $border-radius-lg !important;
  }
}

// CHECKBOXES Y RADIOS MODERNOS
// ============================
.form-check {
  padding-left: 2rem;
  margin-bottom: 1rem;

  .form-check-input {
    width: 1.25rem;
    height: 1.25rem;
    margin-top: 0;
    margin-left: -2rem;
    border: 2px solid $gray-300;
    transition: $transition-all;

    &:checked {
      background-color: $primary;
      border-color: $primary;
      box-shadow: 0 0 0 3px rgba($primary, 0.1);
    }

    &:focus {
      box-shadow: 0 0 0 3px rgba($primary, 0.1);
      border-color: $primary;
    }

    &[type="checkbox"] {
      border-radius: $border-radius;
    }

    &[type="radio"] {
      border-radius: 50%;
    }
  }

  .form-check-label {
    font-weight: $font-weight-medium;
    color: $gray-700;
    cursor: pointer;
    user-select: none;

    &:hover {
      color: $gray-900;
    }
  }
}

// SWITCHES MODERNOS
// =================
.form-switch {
  .form-check-input {
    width: 2.5rem;
    height: 1.25rem;
    background-color: $gray-300;
    border: none;
    border-radius: $border-radius-pill;
    background-image: none;
    transition: $transition-all;
    cursor: pointer;
    position: relative;

    &::before {
      content: '';
      position: absolute;
      top: 2px;
      left: 2px;
      width: calc(1.25rem - 4px);
      height: calc(1.25rem - 4px);
      background: white;
      border-radius: 50%;
      transition: $transition-all;
      box-shadow: $box-shadow-sm;
    }

    &:checked {
      background-color: $primary;

      &::before {
        transform: translateX(1.25rem);
      }
    }

    &:focus {
      box-shadow: 0 0 0 3px rgba($primary, 0.1);
    }

    &:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
  }
  .form-check-label {
    margin-left: 1rem;
  }
}

// SELECT MODERNOS
// ===============
.form-select {
  border: 2px solid $gray-200;
  border-radius: $border-radius-lg;
  padding: 0.75rem 2.5rem 0.75rem 1rem;
  background: white;
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23666' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m1 6 7 7 7-7'/%3e%3c/svg%3e");
  background-repeat: no-repeat;
  background-position: right 0.75rem center;
  background-size: 16px 12px;
  transition: $transition-all;

  &:focus {
    border-color: $primary;
    box-shadow: 0 0 0 3px rgba($primary, 0.1);
    outline: none;
  }

  &:disabled {
    background-color: $gray-50;
    border-color: $gray-200;
    color: $gray-500;
    cursor: not-allowed;
  }

  &.is-invalid {
    border-color: $danger;

    &:focus {
      border-color: $danger;
      box-shadow: 0 0 0 3px rgba($danger, 0.1);
    }
  }

  &.is-valid {
    border-color: $success;

    &:focus {
      border-color: $success;
      box-shadow: 0 0 0 3px rgba($success, 0.1);
    }
  }
}

// TEXTAREA MEJORADO
// =================
textarea.form-control {
  min-height: 120px;
  resize: vertical;

  &.textarea-auto {
    resize: none;
    overflow: hidden;
  }
}

// RANGE INPUTS MODERNOS
// =====================
// =====================================
// FORM RANGE - FIX CENTRADO DEL THUMB
// =====================================

.form-range {
  width: 100%;
  height: 1.5rem; // Altura total del contenedor (igual que tu código original)
  padding: 0;
  background-color: transparent;
  outline: none;
  -webkit-appearance: none;

  // =====================================
  // TRACK (la línea/guía)
  // =====================================

  // Webkit (Chrome, Safari, Edge)
  &::-webkit-slider-track {
    width: 100%;
    height: 0.5rem; // Usar la misma altura que tu código original
    cursor: pointer;
    background: $gray-200; // Usar tu variable original
    border-radius: $border-radius-pill; // Usar tu variable original
    border: none;
  }

  // Firefox
  &::-moz-range-track {
    width: 100%;
    height: 0.5rem; // Misma altura que webkit
    cursor: pointer;
    background: $gray-200; // Usar tu variable original
    border-radius: $border-radius-pill; // Usar tu variable original
    border: none;
  }

  // =====================================
  // THUMB (el puntero/círculo)
  // =====================================

  // Webkit (Chrome, Safari, Edge)
  &::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 1.5rem; // Mantener tu tamaño original
    height: 1.5rem; // Mantener tu tamaño original
    background: $primary; // Usar tu variable original
    border-radius: 50%;
    cursor: pointer;
    border: none; // Sin borde blanco como en tu original
    box-shadow: $box-shadow; // Usar tu sombra original
    transition: $transition-all; // Usar tu transición original

    // 🎯 CLAVE: Centrado vertical perfecto
    // Cálculo: (24px thumb - 8px track) / 2 = 8px
    margin-top: -8px;

    &:hover {
      transform: scale(1.1);
      box-shadow: $box-shadow-lg; // Usar tus sombras originales
    }
  }

  // Firefox
  &::-moz-range-thumb {
    width: 1.5rem; // Mantener tu tamaño original
    height: 1.5rem; // Mantener tu tamaño original
    background: $primary; // Usar tu variable original
    border-radius: 50%;
    cursor: pointer;
    border: none; // Sin borde como en tu original
    box-shadow: $box-shadow; // Usar tu sombra original
    transition: $transition-all; // Usar tu transición original

    // Firefox no necesita margin-top, se centra automáticamente

    &:hover {
      transform: scale(1.1);
      box-shadow: $box-shadow-lg; // Usar tus sombras originales
    }
  }

  // =====================================
  // ESTADOS FOCUS
  // =====================================

  &:focus {
    &::-webkit-slider-thumb {
      box-shadow: 0 0 0 3px rgba($primary, 0.2); // Usar tu variable $primary
    }

    &::-moz-range-thumb {
      box-shadow: 0 0 0 3px rgba($primary, 0.2); // Usar tu variable $primary
    }
  }
}

// =====================================
// VARIANTES DE TAMAÑO
// =====================================

.form-range-sm {
  height: 1.25rem; // Contenedor más pequeño

  &::-webkit-slider-track {
    height: 4px; // Track más delgado
  }

  &::-moz-range-track {
    height: 4px;
  }

  &::-webkit-slider-thumb {
    width: 16px;
    height: 16px;
    margin-top: -6px; // (16px - 4px) / 2 = 6px
  }

  &::-moz-range-thumb {
    width: 16px;
    height: 16px;
  }
}

.form-range-lg {
  height: 1.75rem; // Contenedor más grande

  &::-webkit-slider-track {
    height: 8px; // Track más grueso
  }

  &::-moz-range-track {
    height: 8px;
  }

  &::-webkit-slider-thumb {
    width: 24px;
    height: 24px;
    margin-top: -8px; // (24px - 8px) / 2 = 8px
  }

  &::-moz-range-thumb {
    width: 24px;
    height: 24px;
  }
}

// =====================================
// VARIANTES DE COLOR
// =====================================

.form-range-success {
  &::-webkit-slider-thumb {
    background: var(--success);
  }

  &::-moz-range-thumb {
    background: var(--success);
  }

  &:focus {
    &::-webkit-slider-thumb {
      box-shadow: 0 0 0 3px rgba(5, 150, 105, 0.2);
    }

    &::-moz-range-thumb {
      box-shadow: 0 0 0 3px rgba(5, 150, 105, 0.2);
    }
  }
}

.form-range-warning {
  &::-webkit-slider-thumb {
    background: var(--warning);
  }

  &::-moz-range-thumb {
    background: var(--warning);
  }

  &:focus {
    &::-webkit-slider-thumb {
      box-shadow: 0 0 0 3px rgba(217, 119, 6, 0.2);
    }

    &::-moz-range-thumb {
      box-shadow: 0 0 0 3px rgba(217, 119, 6, 0.2);
    }
  }
}

.form-range-error {
  &::-webkit-slider-thumb {
    background: var(--error);
  }

  &::-moz-range-thumb {
    background: var(--error);
  }

  &:focus {
    &::-webkit-slider-thumb {
      box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.2);
    }

    &::-moz-range-thumb {
      box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.2);
    }
  }
}

// =====================================
// RANGE CON RELLENO (PROGRESS)
// =====================================

.form-range-filled {
  position: relative;

  &::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 0;
    height: 6px;
    background: $primary;
    border-radius: 3px;
    transform: translateY(-50%);

    // El width se controla con JavaScript
    width: var(--range-progress, 0%);

    transition: width 0.1s ease;
    pointer-events: none;
    z-index: 1;
  }

  &::-webkit-slider-thumb {
    position: relative;
    z-index: 2;
  }

  &::-moz-range-thumb {
    position: relative;
    z-index: 2;
  }
}

// =====================================
// UTILIDADES Y HELPERS
// =====================================

// Para mostrar el valor
.form-range-value {
  display: flex;
  align-items: center;
  gap: var(--space-md);

  .range-input {
    flex: 1;
  }

  .range-display {
    min-width: 3rem;
    text-align: center;
    font-weight: 600;
    font-size: 0.875rem;
    color: var(--text-secondary);
    background: var(--bg-secondary);
    padding: var(--space-xs) var(--space-sm);
    border-radius: var(--radius-sm);
  }
}


// FILE INPUTS MODERNOS
// ====================
.form-control[type="file"] {
  padding: 0;
  overflow: hidden;

  &::file-selector-button {
    padding: 0.75rem 1rem;
    background: $gray-100;
    border: none;
    border-right: 2px solid $gray-200;
    color: $gray-700;
    font-weight: $font-weight-semibold;
    transition: $transition-fast;
    cursor: pointer;

    &:hover {
      background: $gray-200;
    }
  }
}

// INPUT CON ICONOS
// ================
.form-icon {
  position: relative;

  .form-control {
    padding-left: 3rem;

    &.icon-right {
      padding-left: 1rem;
      padding-right: 3rem;
    }
  }

  .form-icon-left {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: $gray-500;
    width: 1.25rem;
    height: 1.25rem;
    z-index: 3;
  }

  .form-icon-right {
    position: absolute;
    right: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: $gray-500;
    width: 1.25rem;
    height: 1.25rem;
    z-index: 3;
    cursor: pointer;

    &:hover {
      color: $gray-700;
    }
  }
}

// MENSAJES DE VALIDACIÓN
// ======================
.invalid-feedback {
  display: block;
  color: $danger;
  font-size: $font-size-sm;
  margin-top: 0.5rem;
  font-weight: $font-weight-medium;

  &::before {
    content: '⚠ ';
    margin-right: 0.25rem;
  }
}

.valid-feedback {
  display: block;
  color: $success;
  font-size: $font-size-sm;
  margin-top: 0.5rem;
  font-weight: $font-weight-medium;

  &::before {
    content: '✓ ';
    margin-right: 0.25rem;
  }
}

// GRUPOS DE CAMPOS
// ================
.form-group {
  margin-bottom: 1.5rem;

  &.form-group-sm {
    margin-bottom: 1rem;
  }

  &.form-group-lg {
    margin-bottom: 2rem;
  }

  .form-text {
    color: $gray-600;
    font-size: $font-size-xs;
    margin-top: 0.5rem;
    line-height: 1.4;
  }
}

// FORMULARIOS EN CARDS
// ====================
.form-card {
  background: white;
  border-radius: $border-radius-2xl;
  padding: 2rem;
  box-shadow: $box-shadow-lg;

  .form-header {
    text-align: center;
    margin-bottom: 2rem;

    .form-title {
      font-size: $font-size-2xl;
      font-weight: $font-weight-bold;
      color: $gray-900;
      margin-bottom: 0.5rem;
    }

    .form-subtitle {
      color: $gray-600;
      font-size: $font-size-sm;
    }
  }

  .form-footer {
    margin-top: 2rem;
    padding-top: 1.5rem;
    border-top: 1px solid $gray-100;
    text-align: center;

    .form-links {
      margin-top: 1rem;
      font-size: $font-size-sm;

      a {
        color: $primary;
        text-decoration: none;
        font-weight: $font-weight-semibold;

        &:hover {
          text-decoration: underline;
        }
      }
    }
  }
}

// STEPS FORM
// ==========
.form-steps {
  .steps-nav {
    display: flex;
    justify-content: center;
    margin-bottom: 2rem;

    .step {
      display: flex;
      align-items: center;
      color: $gray-400;
      font-size: $font-size-sm;
      font-weight: $font-weight-semibold;

      &:not(:last-child) {
        margin-right: 2rem;
      }

      .step-number {
        width: 2rem;
        height: 2rem;
        border-radius: 50%;
        background: $gray-200;
        @include center-flex();
        margin-right: 0.5rem;
        font-weight: $font-weight-bold;
        transition: $transition-all;
      }

      &.active {
        color: $primary;

        .step-number {
          background: $primary;
          color: white;
        }
      }

      &.completed {
        color: $success;

        .step-number {
          background: $success;
          color: white;

          &::before {
            content: '✓';
          }
        }
      }
    }
  }

  .step-content {
    display: none;

    &.active {
      display: block;
    }
  }

  .step-actions {
    display: flex;
    justify-content: space-between;
    margin-top: 2rem;
    padding-top: 1.5rem;
    border-top: 1px solid $gray-100;
  }
}

// INLINE FORMS
// ============
.form-inline {
  display: flex;
  align-items: end;
  gap: 1rem;

  .form-group {
    margin-bottom: 0;
    flex: 1;
  }

  .btn {
    white-space: nowrap;
  }

  @include mobile-only {
    flex-direction: column;
    align-items: stretch;

    .form-group {
      margin-bottom: 1rem;
    }
  }
}

// SEARCH FORMS
// ============
.form-search {
  position: relative;

  .search-input {
    padding-right: 3rem;
    border-radius: $border-radius-pill;
  }

  .search-btn {
    position: absolute;
    right: 0.5rem;
    top: 50%;
    transform: translateY(-50%);
    width: 2rem;
    height: 2rem;
    border-radius: 50%;
    border: none;
    background: $primary;
    color: white;
    @include center-flex();
    transition: $transition-all;

    &:hover {
      background: darken($primary, 10%);
      transform: translateY(-50%) scale(1.05);
    }
  }
}

// TAMAÑOS DE FORMULARIOS
// ======================
.form-sm {
  .form-control,
  .form-select {
    padding: 0.5rem 0.75rem;
    font-size: $font-size-sm;
  }

  .form-label {
    font-size: $font-size-xs;
  }
}

.form-lg {
  .form-control,
  .form-select {
    padding: 1rem 1.25rem;
    font-size: $font-size-lg;
  }

  .form-label {
    font-size: $font-size-base;
  }
}

// ESTADOS DE LOADING
// ==================
.form-loading {
  position: relative;

  &::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 255, 255, 0.8);
    @include center-flex();
    z-index: 10;
  }

  &::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 2rem;
    height: 2rem;
    border: 3px solid $gray-200;
    border-top-color: $primary;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    z-index: 11;
  }
}

// RESPONSIVE
// ==========
@include mobile-only {
  .form-control,
  .form-select {
    font-size: 16px; // Evita zoom en iOS
  }

  .form-card {
    padding: 1.5rem;
    border-radius: $border-radius-lg;
  }

  .form-steps {
    .steps-nav {
      flex-direction: column;
      gap: 1rem;

      .step {
        margin-right: 0;
      }
    }
  }
}

// DARK MODE
// =========
@media (prefers-color-scheme: dark) {
  .form-control,
  .form-select {
    background: $gray-800;
    border-color: $gray-600;
    color: $gray-100;

    &:focus {
      background: $gray-700;
    }

    &::placeholder {
      color: $gray-400;
    }
  }

  .form-label {
    color: $gray-200;
  }

  .input-group-text {
    background: $gray-700;
    border-color: $gray-600;
    color: $gray-300;
  }

  .form-card {
    background: $gray-800;

    .form-title {
      color: $gray-100;
    }

    .form-subtitle {
      color: $gray-400;
    }
  }
}
