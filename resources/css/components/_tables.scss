// =====================================
// FRAMEWORK BLADE - SISTEMA DE TABLAS
// =====================================

// Variables específicas para tablas
$table-variables: (
  // Espaciado
  cell-padding-sm: var(--space-xs) var(--space-sm),
  cell-padding-md: var(--space-sm) var(--space-md),
  cell-padding-lg: var(--space-md) var(--space-lg),

  // Colores
  border-color: var(--border-light),
  stripe-bg: var(--bg-secondary),
  hover-bg: #f1f5f9,
  active-bg: #e2e8f0,

  // Header
  header-bg: var(--bg-tertiary),
  header-text: var(--text-primary),
  header-border: var(--border-medium),

  // Estados
  success-bg: #d1fae5,
  warning-bg: #fef3c7,
  error-bg: #fee2e2,
  info-bg: #dbeafe,

  // Sombras y efectos
  shadow: var(--shadow-sm),
  hover-shadow: var(--shadow-md),
  transition: var(--transition-fast)
) !default;

// Mixin para extraer valores de variables
@function table-var($key) {
  @return map-get($table-variables, $key);
}

// =====================================
// TABLA BASE
// =====================================

.table {
  width: 100%;
  margin-bottom: var(--space-lg);
  color: var(--text-primary);
  border-collapse: collapse;
  background: var(--bg-primary);
  border-radius: var(--radius-lg);
  overflow: hidden;
  box-shadow: table-var(shadow);

  // Celdas base
  th, td {
    padding: table-var(cell-padding-md);
    text-align: left;
    border-bottom: 1px solid table-var(border-color);
    vertical-align: middle;
    transition: all table-var(transition);
  }

  // Header
  thead {
    th {
      background: table-var(header-bg);
      color: table-var(header-text);
      font-weight: 600;
      font-size: 0.875rem;
      text-transform: uppercase;
      letter-spacing: 0.025em;
      border-bottom: 2px solid table-var(header-border);
      position: sticky;
      top: 0;
      z-index: 10;
    }
  }

  // Body
  tbody {
    tr {
      transition: all table-var(transition);

      &:last-child {
        td {
          border-bottom: none;
        }
      }
    }
  }

  // Footer
  tfoot {
    th, td {
      background: table-var(header-bg);
      font-weight: 600;
      border-top: 2px solid table-var(header-border);
      border-bottom: none;
    }
  }
}

// =====================================
// VARIANTES DE TABLA
// =====================================

// Tabla con hover
.table-hover {
  tbody tr {
    &:hover {
      background: table-var(hover-bg);
      transform: scale(1.001);
      box-shadow: inset 0 0 0 1px rgba(59, 130, 246, 0.1);
    }
  }
}

// Tabla con rayas
.table-striped {
  tbody tr:nth-child(even) {
    background: table-var(stripe-bg);
  }
}

// Tabla con bordes
.table-bordered {
  border: 1px solid table-var(border-color);

  th, td {
    border: 1px solid table-var(border-color);
  }
}

// Tabla sin bordes
.table-borderless {
  th, td {
    border: none;
  }
}

// Tabla compacta
.table-sm {
  th, td {
    padding: table-var(cell-padding-sm);
    font-size: 0.875rem;
  }
}

// Tabla espaciosa
.table-lg {
  th, td {
    padding: table-var(cell-padding-lg);
    font-size: 1.125rem;
  }
}

// =====================================
// ESTADOS DE FILAS
// =====================================

.table {
  .table-row-active,
  tbody tr.active {
    background: table-var(active-bg);
    color: var(--text-primary);
  }

  .table-row-success,
  tbody tr.success {
    background: table-var(success-bg);

    &:hover {
      background: darken(#d1fae5, 5%);
    }
  }

  .table-row-warning,
  tbody tr.warning {
    background: table-var(warning-bg);

    &:hover {
      background: darken(#fef3c7, 5%);
    }
  }

  .table-row-error,
  tbody tr.error {
    background: table-var(error-bg);

    &:hover {
      background: darken(#fee2e2, 5%);
    }
  }

  .table-row-info,
  tbody tr.info {
    background: table-var(info-bg);

    &:hover {
      background: darken(#dbeafe, 5%);
    }
  }
}

// =====================================
// ALINEACIÓN Y TEXTO
// =====================================

.table {
  .text-left { text-align: left; }
  .text-center { text-align: center; }
  .text-right { text-align: right; }
  .text-nowrap { white-space: nowrap; }
  .text-truncate {
    max-width: 150px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  // Alineación vertical
  .align-top { vertical-align: top; }
  .align-middle { vertical-align: middle; }
  .align-bottom { vertical-align: bottom; }
}

// =====================================
// TABLA RESPONSIVA
// =====================================

// Mixin para evitar problemas con @extend en media queries
@mixin table-responsive-styles {
  display: block;
  width: 100%;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  border-radius: var(--radius-lg);

  .table {
    margin-bottom: 0;
    border-radius: 0;
    box-shadow: none;
  }
}

.table-responsive {
  @include table-responsive-styles;
}

// Breakpoints específicos usando mixin en lugar de @extend
.table-responsive-sm {
  @media (max-width: 575.98px) {
    @include table-responsive-styles;
  }
}

.table-responsive-md {
  @media (max-width: 767.98px) {
    @include table-responsive-styles;
  }
}

.table-responsive-lg {
  @media (max-width: 991.98px) {
    @include table-responsive-styles;
  }
}

// =====================================
// TABLA MÓVIL (STACK)
// =====================================

.table-mobile {
  @media (max-width: 767px) {
    thead {
      display: none;
    }

    tbody, tr, td {
      display: block;
      width: 100%;
    }

    tr {
      background: var(--bg-primary);
      border: 1px solid table-var(border-color);
      border-radius: var(--radius-md);
      margin-bottom: var(--space-md);
      padding: var(--space-md);
      box-shadow: table-var(shadow);
    }

    td {
      border: none;
      border-bottom: 1px solid table-var(border-color);
      position: relative;
      padding-left: 40%;
      padding-top: var(--space-sm);
      padding-bottom: var(--space-sm);

      &:last-child {
        border-bottom: none;
      }

      &:before {
        content: attr(data-label);
        position: absolute;
        left: 0;
        top: var(--space-sm);
        width: 35%;
        font-weight: 600;
        color: var(--text-secondary);
        font-size: 0.875rem;
      }
    }
  }
}

// =====================================
// COMPONENTES ADICIONALES
// =====================================

// Caption de tabla
.table-caption {
  caption-side: top;
  padding: var(--space-md);
  color: var(--text-secondary);
  font-weight: 600;
  text-align: left;
}

// Acciones de tabla
.table-actions {
  display: flex;
  gap: var(--space-sm);
  align-items: center;
  justify-content: flex-end;

  .btn {
    padding: var(--space-xs) var(--space-sm);
    font-size: 0.875rem;
    min-width: auto;
  }
}

// Indicadores de estado
.table-status {
  display: inline-flex;
  align-items: center;
  gap: var(--space-xs);

  &::before {
    content: '';
    width: 8px;
    height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  &.status-active::before { background: var(--success); }
  &.status-inactive::before { background: var(--text-tertiary); }
  &.status-warning::before { background: var(--warning); }
  &.status-error::before { background: var(--error); }
}

// Avatar en tabla
.table-avatar {
  display: flex;
  align-items: center;
  gap: var(--space-sm);

  .avatar {
    width: 32px;
    height: 32px;
    border-radius: var(--radius-full);
    object-fit: cover;
    border: 2px solid var(--border-light);
  }

  .avatar-placeholder {
    width: 32px;
    height: 32px;
    border-radius: var(--radius-full);
    background: var(--primary);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 0.875rem;
  }
}

// =====================================
// UTILIDADES ESPECÍFICAS
// =====================================

// Ancho de columnas
.table {
  .w-auto { width: auto; }
  .w-25 { width: 25%; }
  .w-50 { width: 50%; }
  .w-75 { width: 75%; }
  .w-100 { width: 100%; }

  .w-min { width: 1%; white-space: nowrap; }
  .w-max { width: 99%; }
}

// Ordenación
.table-sortable {
  th {
    cursor: pointer;
    user-select: none;
    position: relative;

    &:hover {
      background: darken(#f3f4f6, 5%);
    }

    &.sort-asc::after {
      content: '↑';
      position: absolute;
      right: var(--space-sm);
      color: var(--primary);
    }

    &.sort-desc::after {
      content: '↓';
      position: absolute;
      right: var(--space-sm);
      color: var(--primary);
    }
  }
}

// =====================================
// ANIMACIONES Y EFECTOS
// =====================================

// Animación de carga
@keyframes tableShimmer {
  0% { background-position: -200px 0; }
  100% { background-position: calc(200px + 100%) 0; }
}

.table-loading {
  .shimmer {
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200px 100%;
    animation: tableShimmer 1.5s infinite;
  }
}

// Efectos de selección
.table-selectable {
  tbody tr {
    cursor: pointer;

    &:hover {
      background: table-var(hover-bg);
    }

    &.selected {
      background: var(--primary-light) !important;
      color: white;

      &:hover {
        background: var(--primary) !important;
      }
    }
  }
}

// =====================================
// DARK MODE SUPPORT
// =====================================

@media (prefers-color-scheme: dark) {
  .table {
    --bg-primary: #1f2937;
    --bg-secondary: #374151;
    --bg-tertiary: #4b5563;
    --text-primary: #f9fafb;
    --text-secondary: #d1d5db;
    --border-light: #4b5563;
    --border-medium: #6b7280;
  }

  .table-hover tbody tr:hover {
    background: #374151;
  }

  .table-striped tbody tr:nth-child(even) {
    background: #374151;
  }
}
